1. ESS new version release and download for deployment
31 March, ESS launched the new 24.1.1 update. Mainly about HPS3 and new equipment.
2. 



## 1. New Features
### ESS
- Algo: 
    - 【HaiPort】HaiPort异常/暂停/禁用场景下的处理
HaiPort异常/暂停/禁用时，暂时不分配该HaiPort的出库任务（适用于无备用口的场景）
    - 【大小车】小车在货架下是否支持旋转，需要提前判断缓存位是否有箱
    - 【大小车】支持配置共享充电桩，并算法调度时判断该充电桩占用状态
- Equipment设备
    - 【大小车】【设备对接】外接“国内安全门”
        - 1. 申请开门时请求全场机器人降速等同于在ESS监控页面点击“安全模式”切换到全场（区域内）降速状态降速成功后，PLC请求开门
        - 2. 复位按钮请求全场机器人恢复速度 等同于在ESS监控页面关闭“安全模式”恢复机器人速度
    - 【3C】【按钮盒对接】按钮盒对接及控制标准方案优化
        1. 按钮盒，触发占用库位时，会使用随机容器编码进行占用库位；支持配置随机占用，指定的容器类型的容器；
        2. 按钮触发区域策略：一键集合，可配置闲时集合/立即集合；
        3. 当按钮绑定的区域策略，存在区域策略不存在的场景，支持配置失败亮灯；
        4. 按钮盒触发创建，随机命中指定库区的1个（数量支持配置）容器，搬运到按钮盒绑定的工作位；
    - 【3C】【A3S】A3S对接及机台交互控制逻辑
    - 【3C】【A3S对接】对接本体读码功能
    - 【3C】【自研A3S-slam】支持配置机器人在地图边上的多个行走方向
    - 【3C】【华睿KIVA避障方案】根据容器类型不同使用不同的避障方案
    - 【3C】【声光报警设备】声光报警设备对接及控制 支持对接声光报警设备
    - 【kubot协议】对接机器人多箱规视觉识别箱宽变宽方案，调度下发指令时指定的BinModel，字段新增*AUTO*枚举值
    - 【安全方案】haiport/输送线安全防护联动方案
    - ESS磁盘自动清理功能需求:**新增定时器**，可配置周期(比如一天或者一周）统计.dat文件目录占用磁盘大小。如果超过配置的阈值，做数据的归档：备份快照到/hairou/map目录，然后执行步骤2, 从前往后删除压缩文件，如果删除完磁盘大小满足指定的条件归档结束
    - 【mock】mock机器人支持异常上报 mock机器人支持异常上报：
        - 1、支持自定义上报数据内容，格式参考本体错误码协议
        - 2、支持配置异常上报间隔
    
### Ngix ESS
- 【ESS前端】ESS电池健康预警: 电池健康预警, 当前机器人电池健康状态值："soh":double  【对应本体状态信息上报协议文档字段】; 后端电量预警策略配置：支持单台机器人电池健康度预警阈值设置，默认70%；
- 【ESS前端】【任务模板】①支持前端页面用户灵活配置各类任务模块；②新增对外标准接口：上游下发任务模板任务给ESS；
    - 通过配置任务模板可以实现单背篓机器人：
        - 1、点对点搬运
        - 2、支持空满交换
        - 3、支持机器人行走到具体位置后停留
        - 4、支持到指定工作位扫描容器信息
- 【ESS前端】【库位预警】优化库位预警配置方案
- 【ESS前端】【区域策略】需要支持框选区域，设定kiva的移动速度
仅支持华睿kiva
- 【ESS前端】随机码功能支持批量导入

## 2. Optimized Features
### ESS
- 【接口】接口校验：完善对外接口校验逻辑
- 【接口】规范对外标准接口返回内容
- 【接口】接口校验：入库任务取消校验逻辑优化
- 【接口】【基础数据】新增“机器人IP”
- 【安全方案】安全策略优化: 接收到安全PLC消防信号后，忽略消防安全区域（即消防通道）内处于恢复状态的机器人，其他机器人驱离后，正常请求开门
- 【安全方案】安全门和绿色通道控制解耦
选中安全门作为绿色通道的起始点，ESS不需要请求开门，仅规划绿色通道路径即可
- 【安全方案】机器人指令超时
因机器人自主避障、安全马甲避障等造成的指令超时，系统认为机器人异常，可以请求安全门打开
- 新版输送线配置优化
- 【3C】【按钮盒】取容器以读取的容器编码执行按钮任务; 优化点：随机容器占用库位后触发搬运任务，取箱以实际读取的容器编码为准去执行搬运任务；
- 双深位取箱优化
当深/浅库位锁定、异常且没有容器的情况下，支持优先分配

### Nginx ESS
-  【ESS前端】界面导出字段支持自定义
    - 支持自定义导出字段：
    - 资源管理-容器、库位
    - 运营管理-任务管理-业务任务
    - 支持国际化
        【ESS前端】界面导出字段支持自定义-Adapter
- 【ESS前端】点位批量配置“zoneType”
- 【库位预警】优化库位预警配置方案
- 【ESS前端】机器人json-机器人异常恢复后，需要清空机器人JSON中的异常信息
- 【ESS前端】优化机器人控制相关按钮的逻辑
- 【ESS前端】监控支持显示异常描述内容
- 【ESS前端】容器移出功能优化
- 【ESS前端】界面去掉Kiva字样: ESS前端界面上不再展示出kiva相关字样，统一替换为haiflex
- 【ESS前端】ESS监控表单字段支持链接跳转
- 【ESS前端】区域策略词条更改

### System safety
- 【系统安全】Devops部署相关安全优化
    - 1、Devops部署的时候配置成https，支持TLS 1.2和 1.3
    - 2、redis密码校验，ESS发布更新时，通知IT一起发布更新REDIS 镜像
    - 3、只允许 localhost 访问，设置为安全模式
- 【系统安全】ESS与机器人使用AES256对私钥进行加密
    - 背景：ESS与机器人使用TLS链路加密，但是数字证书私钥未加密存储，存在被泄露风险
    - 建议使用AES256对私钥进行加密。

- 【系统安全】ESS登录界面账号密码错误时，统一显示成“账户或密码错误”； 背景：在ESS登录界面输入错误密码时，显示密码错误，降低了暴力破解难度；账号输入错误时，显示账号不存在。应统一修改为“账号或密码错误”
- 【系统安全】增加安全日志记录： 产品界面没有安全日志记录，无法有效追溯安全事件的发生；当前只有运行日志；运行日志可读性不强，容易刷屏。ESS操作日志记录只有创建记录和更新记录，没有过程记录。另外，部分国家和地区对日志存储时间均有要求，比如中国要求6个月。建议记录可用于审计系统/用户事件，包括但不限于：
    - 成功登录、注销；
    - 登录尝试失败；
- 【系统安全】将秘钥修改为系统生成，放在配置项中维护，系统提供配置项，支持不同项目的需求； 背景：用户登录ESS系统时，使用开源软件jwt产生token值，但是产生算法HMAC使用的密钥是开源软件默认密钥，且是硬编码在代码中
需求：
    - 1.产品确认可以将秘钥修改为系统生成，放在配置项中维护
    - 2.系统提供配置项，支持不同项目的需求

##   3. BUG FIX
### ESS
- 机器人进入声光报警区域未触发声光报警机制
- 新版输送线配置导入后，生成的http输送线没有对应节点信息
- 上桩时让机器人触发避障导致小车任务异常，虽然小车和充电桩显示在充电，但ess系统任务无法完成
- 配置模板任务后，导出地图重新导入，模板任务丢失
- 刷新前端点位zonetype数据被清空
- 达到呼叫限制，但是没有限制呼叫机器人
- 指定haiport采用异常报警，对应haiport异常后先亮灯后又灭灯
- 配置输送线规则“不会上报，直接完成任务且容器离场”，生成的规则不生效
- 配置了关联库区的逻辑分区[ST1]，匹配库区库位时会将storageTag为空的库位也计算进来
- 配置的关联库区以及逻辑分区至少可用库位数=对应可用库位数时，无法命中该规则
- 未指定异常策略的haiport异常恢复后，对应灯不会灭
- 指定设备采用亮灯策略被禁用场景下，指定设备异常后灯依然会亮

### adapter
- 机器人扫描容器编码后，adapter发送回调报错导致无法收到回调事件
- adapter未展示系统恢复和系统暂停接口

### Nginx
- 前端展示多个预警提示放在一个提示框中，展示不全有下拉框展示
- 库位渲染位置错乱，显示与实际偏差过大

## 4. NEW CONFIGURATION
- ESS:Config:
    - tms/ allowCancelInboundTaskWhenExistTransportTask 容器存在系统任务时是否允许取消入库的业务任务 true允许取消 false 不允许取消
    - inland-safety-door/abnormalProtocol 安全门增加读取异常状态配置
    - ess/fileSmapshotIntervalMs 清理磁盘定时器配置（ms）
- ESS:equipment/model
    - conveyor: 输送线mode配置；输送线配置放到equipment mode下配置，简化之前配置方式
    - buttonBox：按钮盒配置
    - alarm：声光报警器配置：对接声光报警器三色灯设备

- 【大小车场景】
- 【A3S对接扳机场景】